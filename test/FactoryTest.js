require("chai").should();
const Configuration = require("../source/Configuration");
const TestState = require("../source/TestState");

const state = {};
const factory = require("../source/utilities/Factory")(state);

const hours = (hours) => { return 1000 * 60 * 60 * hours };

describe("Factory", () => {

	beforeEach(() => {
		TestState.infuse(state);
	});



	describe("createId", () => {


		it("Should be able to create a unique id of 24 characters", (done) => {
			const id = factory.createId();
			id.should.have.length(24);
			done();
		});


	});



	describe("createShortId", () => {


		it("Should be able to create a shorter id of 20 characters", (done) => {
			const id = factory.createShortId();
			id.should.have.length(20);
			done();
		});


	});



	describe("createSecret", () => {
		it("Should be able to create a random 6 character string", (done) => {
			const secret = factory.createSecret();
			secret.should.have.length(6);
			done();
		});
	});



	describe("createImage", () => {


		it("Should be able to create an image", (done) => {
			state.factory.createId = () => { return "image-id" };
			const image = factory.createImage("image-data");
			const expectedImage = { _id: "image-id", image: "image-data" };
			image.should.deep.equal(expectedImage);
			done();
		});


	});



	describe("createUserCredential", () => {


		it("Should be able to create a user credential", (done) => {
			state.calendar.now = () => { return new Date(500) };
			state.factory.createId = () => { return "credential-id" };
			const user = { _id: "user-id" };
			const credential = factory.createUserCredential(user);

			const expectedCredential = { _id: "credential-id", role: "User", userId: "user-id", expires: 500 + hours(72) };
			credential.should.deep.equal(expectedCredential);
			done();
		});


	});



	describe("createAdminCredential", () => {


		it("Should be able to create an admin credential", (done) => {
			state.calendar.now = () => { return new Date(500) };
			state.factory.createId = () => { return "credential-id" };
			const credential = factory.createAdminCredential();

			const expectedCredential = { _id: "credential-id", role: "Admin", expires: 500 + hours(24) };
			credential.should.deep.equal(expectedCredential);
			done();
		});


	});



	describe("createUser", () => {


		it("Should be able to create a user", (done) => {
			state.factory.createId = () => { return "user-id" };
			const user = factory.createUser({ email: "stuff@stuff.dk", password: "1234", name: "Peter", mobile: "12345678", creditCard: "credit-card-link" });
			
			const expectedUser = { _id: "user-id", email: "stuff@stuff.dk", password: "1234", facebookUserId: undefined, name: "Peter", description: undefined, avatar: undefined, mobile: "12345678", ratings: [], creditCard: "credit-card-link", activeDeliverer: true, orders: [], bids: [] };
			user.should.deep.equal(expectedUser);
			done();
		});


	});



	describe("createFacebookUser", () => {


		it("Should be able to create a facebook user", (done) => {
			state.factory.createId = () => { return "user-id" };
			const input = { name: "Peter", password: "1234", mobile: "12345678", creditCard: "credit-card-link" };
			const data = { id: "peter1234", email: "stuff@stuff.dk" };
			const image = { _id: "image-id", avatar: "image"};
			const user = factory.createFacebookUser(input, data, image);
			
			const expectedUser = { _id: "user-id", email: "stuff@stuff.dk", password: "1234", facebookUserId: "peter1234", name: "Peter", description: undefined, avatar: "image-id", mobile: "12345678", ratings: [], creditCard: "credit-card-link", activeDeliverer: true, orders: [], bids: [] };
			user.should.deep.equal(expectedUser);
			done();
		});


	});



	describe("createOrder", () => {


		it("Should be able to create an order", (done) => {
			state.factory.createShortId = () => { return "order-id" };
			state.calendar.now = () => { return new Date(1500) };
			const input = { expensive: true, description: "Description", paymentType: "MobilePay", cost: undefined, deliveryPrice: 39, deliveryTime: "delivery-time", deliveryAddress: "delivery-address", pickupAddress: "pickup-address" };
			const order = factory.createOrder(input);

			const expectedOrder = { _id: "order-id", expensive: true, description: "Description", paymentType: "MobilePay", cost: undefined, deliveryPrice: 39, deliveryTime: "delivery-time", scheduledDeliveryTime: undefined, deliveryAddress: "delivery-address", pickupAddress: "pickup-address", creationDate: 1500, bids: [], acceptedBid: undefined, state: "Pending", location: undefined };
			order.should.deep.equal(expectedOrder);
			done();
		});


	});



	describe("createBid", () => {


		it("Should be able to create a bid", (done) => {
			state.factory.createId = () => { return "bid-id" };
			const input = { deliveryPrice: 20, deliveryTime: 500 };
			const bid = factory.createBid("order-id", "user-id", input);

			const expectedBid = { _id: "bid-id", orderId: "order-id", userId: "user-id", deliveryPrice: 20, deliveryTime: 500 };
			bid.should.deep.equal(expectedBid);
			done();
		});


	});



	describe("createDeliverer", () => {
		

		it("Should be able to create a deliverer", (done) => {
			const user = { _id: "user-id", name: "Peter", mobile: "12345678", avatar: "image-id", description: "Description", ratings: [3]};
			const deliverer = factory.createDeliverer(user);

			const expectedDeliverer = { name: "Peter", mobile: "12345678", avatar: "image-id", description: "Description", ratings: [3]};
			deliverer.should.deep.equal(expectedDeliverer);
			done();
		});


	});



	describe("createReceiver", () => {


		it("Should be able to create a receiver", (done) => {
			const user = { _id: "user-id", name: "Peter", mobile: "12345678" };
			const receiver = factory.createReceiver(user);

			const expectedReceiver = { name: "Peter", mobile: "12345678" };
			receiver.should.deep.equal(expectedReceiver);
			done();
		});


	});



	describe("createChallenge", () => {


		it("Should be able to create a challenge", (done) => {
			state.factory.createId = () => { return "challenge-id" };
			state.factory.createSecret = () => { return "secret" };
			state.calendar.now = () => { return new Date(1000) };
			const challenge = factory.createChallenge("user-id");

			const expectedChallenge = {_id: "challenge-id", userId: "user-id", secret: "secret", expires: 1000 + (1000 * 60 * 5) };
			challenge.should.deep.equal(expectedChallenge);
			done();
		});

		
	});



	describe("Mails", () => {
		

		it("Should be able to create a challenge mail", (done) => {
			const user = { name: "Peter Hansen", email: "stuff@stuff.dk" };
			const mail = factory.createChallengeMail(user, "some-secret");

			const expectedMail = {
				from: "EpsilonApi <support@epsilon-api.com>",
				to: "stuff@stuff.dk",
				subject: "EpsilonApi - Verifikationskode",
				html: "<!DOCTYPE html \"-//w3c//dtd xhtml 1.0 transitional //en\" \"http://www.w3.org/tr/xhtml1/dtd/xhtml1-transitional.dtd\"><html xmlns=\"http://www.w3.org/1999/xhtml\"><head> <!--[if gte mso 9]><xml> <o:OfficeDocumentSettings> <o:AllowPNG/> <o:PixelsPerInch>96</o:PixelsPerInch> </o:OfficeDocumentSettings> </xml><![endif]--> <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"> <meta name=\"viewport\" content=\"width=device-width\"> <meta http-equiv=\"X-UA-Compatible\" content=\"IE=9; IE=8; IE=7; IE=EDGE\"> <title>Template Base</title> </head> <body style=\"width: 100% !important;min-width: 100%;-webkit-text-size-adjust: 100%;-ms-text-size-adjust: 100% !important;margin: 0;padding: 0;background-color: #FFFFFF\"> <style id=\"media-query\"> /* Client-specific Styles & Reset */ #outlook a { padding: 0; } /* .ExternalClass applies to Outlook.com (the artist formerly known as Hotmail) */ .ExternalClass { width: 100%; } .ExternalClass, .ExternalClass p, .ExternalClass span, .ExternalClass font, .ExternalClass td, .ExternalClass div { line-height: 100%; } #backgroundTable { margin: 0; padding: 0; width: 100% !important; line-height: 100% !important; } /* Buttons */ .button a { display: inline-block; text-decoration: none; -webkit-text-size-adjust: none; text-align: center; } .button a div { text-align: center !important; } /* Outlook First */ body.outlook p { display: inline !important; } /* Media Queries */ @media only screen and (max-width: 500px) { table[class=\"body\"] img { height: auto !important; width: 100% !important; } table[class=\"body\"] img.fullwidth { max-width: 100% !important; } table[class=\"body\"] center { min-width: 0 !important; } table[class=\"body\"] .container { width: 95% !important; } table[class=\"body\"] .row { width: 100% !important; display: block !important; } table[class=\"body\"] .wrapper { display: block !important; padding-right: 0 !important; } table[class=\"body\"] .columns, table[class=\"body\"] .column { table-layout: fixed !important; float: none !important; width: 100% !important; padding-right: 0px !important; padding-left: 0px !important; display: block !important; } table[class=\"body\"] .wrapper.first .columns, table[class=\"body\"] .wrapper.first .column { display: table !important; } table[class=\"body\"] table.columns td, table[class=\"body\"] table.column td, .col { width: 100% !important; } table[class=\"body\"] table.columns td.expander { width: 1px !important; } table[class=\"body\"] .right-text-pad, table[class=\"body\"] .text-pad-right { padding-left: 10px !important; } table[class=\"body\"] .left-text-pad, table[class=\"body\"] .text-pad-left { padding-right: 10px !important; } table[class=\"body\"] .hide-for-small, table[class=\"body\"] .show-for-desktop { display: none !important; } table[class=\"body\"] .show-for-small, table[class=\"body\"] .hide-for-desktop { display: inherit !important; } .mixed-two-up .col { width: 100% !important; } } @media screen and (max-width: 500px) { div[class=\"col\"] { width: 100% !important; } } @media screen and (min-width: 501px) { table[class=\"container\"] { width: 500px !important; } } </style> <table class=\"body\" style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;height: 100%;width: 100%;table-layout: fixed\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" border=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td class=\"center\" style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;text-align: center;background-color: #FFFFFF\" align=\"center\" valign=\"top\"> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;background-color: #FFFFFF\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"100%\"> <!--[if gte mso 9]> <table id=\"outlookholder\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\"><tr><td> <![endif]--> <!--[if (IE)]> <table width=\"500\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"> <tr> <td> <![endif]--> <table class=\"container\" style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;max-width: 500px;margin: 0 auto;text-align: inherit\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"100%\"><table class=\"block-grid\" style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;width: 100%;max-width: 500px;color: #333;background-color: transparent\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" bgcolor=\"transparent\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;text-align: center;font-size: 0\"><!--[if (gte mso 9)|(IE)]><table width=\"100%\" align=\"center\" bgcolor=\"transparent\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tr><![endif]--><!--[if (gte mso 9)|(IE)]><td valign=\"top\" width=\"500\"><![endif]--><div class=\"col num12\" style=\"display: inline-block;vertical-align: top;width: 100%\"><table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;background-color: transparent;padding-top: 20px;padding-right: 0px;padding-bottom: 20px;padding-left: 0px;border-top: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-left: 0px solid transparent\"><table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" border=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;width: 100%\" align=\"center\"> <div style=\"font-size:12px\" align=\"center\"> <img class=\"center fullwidth\" style=\"outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: block;border: 0;height: auto;line-height: 100%;margin: 0 auto;float: none;width: 100% !important;max-width: 500px\" align=\"center\" border=\"0\" src=\"https://epsilon-api.com/images/mail-header.png\" alt=\"Image\" title=\"Image\" width=\"500\"> </div> </td> </tr> </tbody></table> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" align=\"center\" width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;padding-top: 10px;padding-right: 10px;padding-bottom: 10px;padding-left: 10px\" align=\"center\"> <div style=\"height: 1px;\"> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;border-top: 1px solid #BBBBBB;width: 100%\" align=\"center\" border=\"0\" cellspacing=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" align=\"center\"></td> </tr> </tbody></table> </div> </td> </tr> </tbody></table><table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;padding-top: 10px;padding-right: 10px;padding-bottom: 0px;padding-left: 10px\"> <div style=\"color:#FFFFFF;line-height:120%;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;\"> <div style=\"font-size:12px;line-height:14px;color:#FFFFFF;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;text-align:left;\"><p style=\"margin: 0;font-size: 12px;line-height: 14px;text-align: center\"><span style=\"font-size: 24px; line-height: 28px;\"><span style=\"line-height: 28px; font-size: 24px;\"><span style=\"color: rgb(0, 0, 0); font-size: 24px; line-height: 28px;\">Hej Peter</span>&nbsp;</span><span style=\"line-height: 28px; font-size: 24px;\"><strong>&#65279;</strong></span></span></p></div> </div> </td> </tr> </tbody></table> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;padding-top: 5px;padding-right: 10px;padding-bottom: 10px;padding-left: 10px\"> <div style=\"color:#FFFFFF;line-height:120%;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;\"> <div style=\"font-size:12px;line-height:14px;color:#FFFFFF;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;text-align:left;\"><p style=\"margin: 0;font-size: 12px;line-height: 14px;text-align: center\"><span style=\"font-size: 14px; line-height: 16px; color: rgb(0, 0, 0);\"><span style=\"line-height: 16px; font-size: 14px;\">&#65279;</span><span style=\"line-height: 21px; font-size: 18px;\">Dette er din verifikationskode</span></span></p><p style=\"margin: 0;font-size: 12px;line-height: 14px;text-align: center\"><span style=\"font-size: 14px; line-height: 16px; color: rgb(0, 0, 0);\"><span style=\"line-height: 21px; font-size: 18px;\">some-secret</span></span></p></div> </div> </td> </tr> </tbody></table> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;padding-top: 15px;padding-right: 10px;padding-bottom: 10px;padding-left: 10px\"> <div style=\"color:#FFFFFF;line-height:120%;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;\"> <div style=\"font-size:12px;line-height:14px;color:#FFFFFF;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;text-align:left;\"><p style=\"margin: 0;font-size: 14px;line-height: 17px;text-align: center\"><span style=\"color: rgb(0, 0, 0); font-size: 14px; line-height: 16px;\">Brug verifikationskoden til at &#230;ndre dit kodeord.</span></p><p style=\"margin: 0;font-size: 14px;line-height: 16px;text-align: center\"><span style=\"color: rgb(0, 0, 0); font-size: 14px; line-height: 16px;\">&nbsp;</span><br></p><p style=\"margin: 0;font-size: 14px;line-height: 16px;text-align: center\"><span style=\"color: rgb(0, 0, 0); font-size: 14px; line-height: 16px;\">Med venlig hilsen</span></p><p style=\"margin: 0;font-size: 14px;line-height: 16px;text-align: center\"><span style=\"color: rgb(0, 0, 0); font-size: 14px; line-height: 16px;\">EpsilonApi</span></p></div> </div> </td> </tr> </tbody></table> </td></tr></tbody></table></div><!--[if (gte mso 9)|(IE)]></td><![endif]--><!--[if (gte mso 9)|(IE)]></td></tr></table><![endif]--></td></tr></tbody></table></td></tr></tbody></table> <!--[if mso]> </td></tr></table> <![endif]--> <!--[if (IE)]> </td></tr></table> <![endif]--> </td> </tr> </tbody></table> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;background-color: #FFFFFF\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"100%\"> <!--[if gte mso 9]> <table id=\"outlookholder\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\"><tr><td> <![endif]--> <!--[if (IE)]> <table width=\"500\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"> <tr> <td> <![endif]--> <table class=\"container\" style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;max-width: 500px;margin: 0 auto;text-align: inherit\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"100%\"><table class=\"block-grid\" style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;width: 100%;max-width: 500px;color: #333;background-color: transparent\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" bgcolor=\"transparent\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;text-align: center;font-size: 0\"><!--[if (gte mso 9)|(IE)]><table width=\"100%\" align=\"center\" bgcolor=\"transparent\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tr><![endif]--><!--[if (gte mso 9)|(IE)]><td valign=\"top\" width=\"500\"><![endif]--><div class=\"col num12\" style=\"display: inline-block;vertical-align: top;width: 100%\"><table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;background-color: transparent;padding-top: 30px;padding-right: 0px;padding-bottom: 30px;padding-left: 0px;border-top: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-left: 0px solid transparent\"><table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;padding-top: 10px;padding-right: 10px;padding-bottom: 10px;padding-left: 10px\"> <div style=\"color:#bbbbbb;line-height:120%;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;\"> <div style=\"font-size:12px;line-height:14px;color:#bbbbbb;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;text-align:left;\"><p style=\"margin: 0;font-size: 18px;line-height: 22px;text-align: center\">&nbsp;<span style=\"font-size: 14px; line-height: 16px;\">support@epsilon-api.com</span></p></div> </div> </td> </tr> </tbody></table> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" border=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;width: 100%\" align=\"center\"> <div style=\"font-size:12px\" align=\"center\"> <img class=\"center fullwidth\" style=\"outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: block;border: 0;height: auto;line-height: 100%;margin: 0 auto;float: none;width: 100% !important;max-width: 500px\" align=\"center\" border=\"0\" src=\"https://epsilon-api.com/images/mail-footer.png\" alt=\"Image\" title=\"Image\" width=\"500\"> </div> </td> </tr> </tbody></table> </td></tr></tbody></table></div><!--[if (gte mso 9)|(IE)]></td><![endif]--><!--[if (gte mso 9)|(IE)]></td></tr></table><![endif]--></td></tr></tbody></table></td></tr></tbody></table> <!--[if mso]> </td></tr></table> <![endif]--> <!--[if (IE)]> </td></tr></table> <![endif]--> </td> </tr> </tbody></table> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;background-color: #010000\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"100%\"> <!--[if gte mso 9]> <table id=\"outlookholder\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\"><tr><td> <![endif]--> <!--[if (IE)]> <table width=\"500\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"> <tr> <td> <![endif]--> <table class=\"container\" style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;max-width: 500px;margin: 0 auto;text-align: inherit\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"100%\"><table class=\"block-grid\" style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;width: 100%;max-width: 500px;color: #333;background-color: transparent\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" bgcolor=\"transparent\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;text-align: center;font-size: 0\"><!--[if (gte mso 9)|(IE)]><table width=\"100%\" align=\"center\" bgcolor=\"transparent\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tr><![endif]--><!--[if (gte mso 9)|(IE)]><td valign=\"top\" width=\"500\"><![endif]--><div class=\"col num12\" style=\"display: inline-block;vertical-align: top;width: 100%\"><table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;background-color: transparent;padding-top: 25px;padding-right: 0px;padding-bottom: 25px;padding-left: 0px;border-top: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-left: 0px solid transparent\"> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" align=\"center\" valign=\"top\"> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;text-align: center;padding-top: 10px;padding-right: 10px;padding-bottom: 10px;padding-left: 10px;max-width: 82px\" align=\"center\" valign=\"top\"> <!--[if (gte mso 9)|(IE)]> <table width=\"92\" align=\"left\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"> <tr> <td align=\"left\"> <![endif]--> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" width=\"100%\" align=\"left\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" align=\"left\" valign=\"middle\"> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;padding: 0 5px 5px 0\" align=\"left\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" height=\"37\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"37\" align=\"left\" valign=\"middle\"> <a href=\"https://www.facebook.com/EpsilonApi\" title=\"Facebook\" target=\"_blank\"> <img style=\"outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: block;border: none;height: auto;line-height: 100%;max-width: 32px !important\" src=\"https://epsilon-api.com/images/facebook.png\" alt=\"Facebook\" title=\"Facebook\" width=\"32\"> </a> </td> </tr> </tbody></table> </td> </tr> </tbody></table> <!--[if (gte mso 9)|(IE)]> </td> </tr> </table> <![endif]--> </td> </tr> </tbody></table> </td> </tr> </tbody></table></td></tr></tbody></table></div><!--[if (gte mso 9)|(IE)]></td><![endif]--><!--[if (gte mso 9)|(IE)]></td></tr></table><![endif]--></td></tr></tbody></table></td></tr></tbody></table> <!--[if mso]> </td></tr></table> <![endif]--> <!--[if (IE)]> </td></tr></table> <![endif]--> </td> </tr> </tbody></table> </td> </tr> </tbody></table> </body></html>",
				text: "Hej Peter\nDette er din verifikationskode\nsome-secret\n\n Brug verifikationskoden til at ændre dit kodeord.\n\nMed venlig hilsen\nEpsilonApi\n\nsupport@epsilon-api.com"
			};
			mail.should.deep.equal(expectedMail);
			done();
		});


		it("Should be able to create a receipt mail for the receiver", (done) => {
			const receiver = { name: "Peter Hansen", email: "receiver@developer.dk" };
			const deliverer = { name: "Anders Madsen" };
			const order = { description: "Jeg skal have indkøbt æg og det skal gå stærkt!", deliveryAddress: { name: "Ryesgade 32, 8000 Aarhus" }, scheduledDeliveryTime: 7000000 };
			const bid = { deliveryPrice: 1234.5678 };
			const mail = factory.createReceiptMailForReceiver(receiver, deliverer, order, bid);

			const expectedMail = {
				from: "EpsilonApi <support@epsilon-api.com>",
				to: "receiver@developer.dk",
				subject: "EpsilonApi - Fuldendt bestilling",
				html: "<!DOCTYPE html \"-//w3c//dtd xhtml 1.0 transitional //en\" \"http://www.w3.org/tr/xhtml1/dtd/xhtml1-transitional.dtd\"><html xmlns=\"http://www.w3.org/1999/xhtml\"><head> <!--[if gte mso 9]><xml> <o:OfficeDocumentSettings> <o:AllowPNG/> <o:PixelsPerInch>96</o:PixelsPerInch> </o:OfficeDocumentSettings> </xml><![endif]--> <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"> <meta name=\"viewport\" content=\"width=device-width\"> <meta http-equiv=\"X-UA-Compatible\" content=\"IE=9; IE=8; IE=7; IE=EDGE\"> <title>Template Base</title> </head> <body style=\"width: 100% !important;min-width: 100%;-webkit-text-size-adjust: 100%;-ms-text-size-adjust: 100% !important;margin: 0;padding: 0;background-color: #FFFFFF\"> <style id=\"media-query\"> /* Client-specific Styles & Reset */ #outlook a { padding: 0; } /* .ExternalClass applies to Outlook.com (the artist formerly known as Hotmail) */ .ExternalClass { width: 100%; } .ExternalClass, .ExternalClass p, .ExternalClass span, .ExternalClass font, .ExternalClass td, .ExternalClass div { line-height: 100%; } #backgroundTable { margin: 0; padding: 0; width: 100% !important; line-height: 100% !important; } /* Buttons */ .button a { display: inline-block; text-decoration: none; -webkit-text-size-adjust: none; text-align: center; } .button a div { text-align: center !important; } /* Outlook First */ body.outlook p { display: inline !important; } /* Media Queries */ @media only screen and (max-width: 500px) { table[class=\"body\"] img { height: auto !important; width: 100% !important; } table[class=\"body\"] img.fullwidth { max-width: 100% !important; } table[class=\"body\"] center { min-width: 0 !important; } table[class=\"body\"] .container { width: 95% !important; } table[class=\"body\"] .row { width: 100% !important; display: block !important; } table[class=\"body\"] .wrapper { display: block !important; padding-right: 0 !important; } table[class=\"body\"] .columns, table[class=\"body\"] .column { table-layout: fixed !important; float: none !important; width: 100% !important; padding-right: 0px !important; padding-left: 0px !important; display: block !important; } table[class=\"body\"] .wrapper.first .columns, table[class=\"body\"] .wrapper.first .column { display: table !important; } table[class=\"body\"] table.columns td, table[class=\"body\"] table.column td, .col { width: 100% !important; } table[class=\"body\"] table.columns td.expander { width: 1px !important; } table[class=\"body\"] .right-text-pad, table[class=\"body\"] .text-pad-right { padding-left: 10px !important; } table[class=\"body\"] .left-text-pad, table[class=\"body\"] .text-pad-left { padding-right: 10px !important; } table[class=\"body\"] .hide-for-small, table[class=\"body\"] .show-for-desktop { display: none !important; } table[class=\"body\"] .show-for-small, table[class=\"body\"] .hide-for-desktop { display: inherit !important; } .mixed-two-up .col { width: 100% !important; } } @media screen and (max-width: 500px) { div[class=\"col\"] { width: 100% !important; } } @media screen and (min-width: 501px) { table[class=\"container\"] { width: 500px !important; } } </style> <table class=\"body\" style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;height: 100%;width: 100%;table-layout: fixed\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" border=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td class=\"center\" style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;text-align: center;background-color: #FFFFFF\" align=\"center\" valign=\"top\"> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;background-color: #FFFFFF\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"100%\"> <!--[if gte mso 9]> <table id=\"outlookholder\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\"><tr><td> <![endif]--> <!--[if (IE)]> <table width=\"500\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"> <tr> <td> <![endif]--> <table class=\"container\" style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;max-width: 500px;margin: 0 auto;text-align: inherit\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"100%\"><table class=\"block-grid\" style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;width: 100%;max-width: 500px;color: #333;background-color: transparent\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" bgcolor=\"transparent\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;text-align: center;font-size: 0\"><!--[if (gte mso 9)|(IE)]><table width=\"100%\" align=\"center\" bgcolor=\"transparent\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tr><![endif]--><!--[if (gte mso 9)|(IE)]><td valign=\"top\" width=\"500\"><![endif]--><div class=\"col num12\" style=\"display: inline-block;vertical-align: top;width: 100%\"><table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;background-color: transparent;padding-top: 20px;padding-right: 0px;padding-bottom: 20px;padding-left: 0px;border-top: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-left: 0px solid transparent\"><table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" border=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;width: 100%\" align=\"center\"> <div style=\"font-size:12px\" align=\"center\"> <img class=\"center fullwidth\" style=\"outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: block;border: 0;height: auto;line-height: 100%;margin: 0 auto;float: none;width: 100% !important;max-width: 500px\" align=\"center\" border=\"0\" src=\"https://epsilon-api.com/images/mail-header.png\" alt=\"Image\" title=\"Image\" width=\"500\"> </div> </td> </tr> </tbody></table> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" align=\"center\" width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;padding-top: 10px;padding-right: 10px;padding-bottom: 10px;padding-left: 10px\" align=\"center\"> <div style=\"height: 1px;\"> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;border-top: 1px solid #BBBBBB;width: 100%\" align=\"center\" border=\"0\" cellspacing=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" align=\"center\"></td> </tr> </tbody></table> </div> </td> </tr> </tbody></table><table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;padding-top: 10px;padding-right: 10px;padding-bottom: 0px;padding-left: 10px\"> <div style=\"color:#FFFFFF;line-height:120%;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;\"> <div style=\"font-size:12px;line-height:14px;color:#FFFFFF;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;text-align:left;\"><p style=\"margin: 0;font-size: 12px;line-height: 14px;text-align: left\"><span style=\"font-size: 24px; line-height: 28px;\"><span style=\"line-height: 28px; font-size: 24px;\"><font color=\"#000000\">Kvittering</font>&nbsp;</span><span style=\"line-height: 28px; font-size: 24px;\"><strong>&#65279;</strong></span></span></p></div> </div> </td> </tr> </tbody></table> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;padding-top: 15px;padding-right: 10px;padding-bottom: 10px;padding-left: 10px\"> <div style=\"color:#010000;line-height:120%;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;\"> <div style=\"font-size:12px;line-height:14px;color:#010000;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;text-align:left;\"><p style=\"margin: 0;font-size: 12px;line-height: 14px\">Hej Peter&nbsp;&#65279;<br>&#65279;Dette er din kvittering.</p></div><div style=\"font-size:12px;line-height:14px;color:#010000;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;text-align:left;\"><p style=\"margin: 0;font-size: 12px;line-height: 14px\">&nbsp;</p></div><div style=\"font-size:12px;line-height:14px;color:#010000;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;text-align:left;\"><p style=\"margin: 0;font-size: 12px;line-height: 14px\">Du har d. 1/1-1970 kl. 02:56 f&#229;et bragt \"Jeg skal have indkøbt æg og det skal gå stærkt!\" ud af Anders Madsen til adressen Ryesgade 32, 8000 Aarhus.</p></div><div style=\"font-size:12px;line-height:14px;color:#010000;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;text-align:left;\"><p style=\"margin: 0;font-size: 12px;line-height: 14px\">&nbsp;</p></div><div style=\"font-size:12px;line-height:14px;color:#010000;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;text-align:left;\"><p style=\"margin: 0;font-size: 12px;line-height: 14px\">Du har betalt 1.234,57 dkr til Anders Madsen som l&#248;n for hans udbringning.</p></div><div style=\"font-size:12px;line-height:14px;color:#010000;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;text-align:left;\"><p style=\"margin: 0;font-size: 12px;line-height: 14px\">&nbsp;</p></div><div style=\"font-size:12px;line-height:14px;color:#010000;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;text-align:left;\"><p style=\"margin: 0;font-size: 12px;line-height: 14px\"><br>Tak fordi du har valgt at bruge EpsilonApi!</p></div><div style=\"font-size:12px;line-height:14px;color:#010000;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;text-align:left;\"><p style=\"margin: 0;font-size: 12px;line-height: 14px\">Vi ser frem til at hj&#230;lpe dig fremover med udbringning.</p></div><div style=\"font-size:12px;line-height:14px;color:#010000;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;text-align:left;\"><p style=\"margin: 0;font-size: 12px;line-height: 14px\">&nbsp;&nbsp;</p></div><div style=\"font-size:12px;line-height:14px;color:#010000;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;text-align:left;\"><p style=\"margin: 0;font-size: 12px;line-height: 14px\">Med venlig hilsen</p></div><div style=\"font-size:12px;line-height:14px;color:#010000;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;text-align:left;\"><p style=\"margin: 0;font-size: 12px;line-height: 14px\">EpsilonApi</p></div> </div> </td> </tr> </tbody></table> </td></tr></tbody></table></div><!--[if (gte mso 9)|(IE)]></td><![endif]--><!--[if (gte mso 9)|(IE)]></td></tr></table><![endif]--></td></tr></tbody></table></td></tr></tbody></table> <!--[if mso]> </td></tr></table> <![endif]--> <!--[if (IE)]> </td></tr></table> <![endif]--> </td> </tr> </tbody></table> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;background-color: #FFFFFF\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"100%\"> <!--[if gte mso 9]> <table id=\"outlookholder\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\"><tr><td> <![endif]--> <!--[if (IE)]> <table width=\"500\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"> <tr> <td> <![endif]--> <table class=\"container\" style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;max-width: 500px;margin: 0 auto;text-align: inherit\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"100%\"><table class=\"block-grid\" style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;width: 100%;max-width: 500px;color: #333;background-color: transparent\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" bgcolor=\"transparent\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;text-align: center;font-size: 0\"><!--[if (gte mso 9)|(IE)]><table width=\"100%\" align=\"center\" bgcolor=\"transparent\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tr><![endif]--><!--[if (gte mso 9)|(IE)]><td valign=\"top\" width=\"500\"><![endif]--><div class=\"col num12\" style=\"display: inline-block;vertical-align: top;width: 100%\"><table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;background-color: transparent;padding-top: 30px;padding-right: 0px;padding-bottom: 30px;padding-left: 0px;border-top: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-left: 0px solid transparent\"><table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" border=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;width: 100%\" align=\"center\"> <div style=\"font-size:12px\" align=\"center\"> <img class=\"center fullwidth\" style=\"outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: block;border: 0;height: auto;line-height: 100%;margin: 0 auto;float: none;width: 100% !important;max-width: 500px\" align=\"center\" border=\"0\" src=\"https://epsilon-api.com/images/mail-footer.png\" alt=\"Image\" title=\"Image\" width=\"500\"> </div> </td> </tr> </tbody></table> </td></tr></tbody></table></div><!--[if (gte mso 9)|(IE)]></td><![endif]--><!--[if (gte mso 9)|(IE)]></td></tr></table><![endif]--></td></tr></tbody></table></td></tr></tbody></table> <!--[if mso]> </td></tr></table> <![endif]--> <!--[if (IE)]> </td></tr></table> <![endif]--> </td> </tr> </tbody></table> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;background-color: #010000\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"100%\"> <!--[if gte mso 9]> <table id=\"outlookholder\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\"><tr><td> <![endif]--> <!--[if (IE)]> <table width=\"500\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"> <tr> <td> <![endif]--> <table class=\"container\" style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;max-width: 500px;margin: 0 auto;text-align: inherit\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"100%\"><table class=\"block-grid\" style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;width: 100%;max-width: 500px;color: #333;background-color: transparent\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" bgcolor=\"transparent\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;text-align: center;font-size: 0\"><!--[if (gte mso 9)|(IE)]><table width=\"100%\" align=\"center\" bgcolor=\"transparent\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tr><![endif]--><!--[if (gte mso 9)|(IE)]><td valign=\"top\" width=\"500\"><![endif]--><div class=\"col num12\" style=\"display: inline-block;vertical-align: top;width: 100%\"><table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;background-color: transparent;padding-top: 25px;padding-right: 0px;padding-bottom: 25px;padding-left: 0px;border-top: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-left: 0px solid transparent\"> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" align=\"center\" valign=\"top\"> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;text-align: center;padding-top: 10px;padding-right: 10px;padding-bottom: 10px;padding-left: 10px;max-width: 82px\" align=\"center\" valign=\"top\"> <!--[if (gte mso 9)|(IE)]> <table width=\"92\" align=\"left\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"> <tr> <td align=\"left\"> <![endif]--> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" width=\"100%\" align=\"left\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" align=\"left\" valign=\"middle\"> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;padding: 0 5px 5px 0\" align=\"left\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" height=\"37\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"37\" align=\"left\" valign=\"middle\"> <a href=\"https://www.facebook.com/EpsilonApi\" title=\"Facebook\" target=\"_blank\"> <img style=\"outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: block;border: none;height: auto;line-height: 100%;max-width: 32px !important\" src=\"https://epsilon-api.com/images/facebook.png\" alt=\"Facebook\" title=\"Facebook\" width=\"32\"> </a> </td> </tr> </tbody></table> </td> </tr> </tbody></table> <!--[if (gte mso 9)|(IE)]> </td> </tr> </table> <![endif]--> </td> </tr> </tbody></table> </td> </tr> </tbody></table></td></tr></tbody></table></div><!--[if (gte mso 9)|(IE)]></td><![endif]--><!--[if (gte mso 9)|(IE)]></td></tr></table><![endif]--></td></tr></tbody></table></td></tr></tbody></table> <!--[if mso]> </td></tr></table> <![endif]--> <!--[if (IE)]> </td></tr></table> <![endif]--> </td> </tr> </tbody></table> </td> </tr> </tbody></table> </body></html>",
				text: "Kvittering\n\nHej Peter\nDette er din kvittering.\n\nDu har d. 1/1-1970 kl. 02:56 fået bragt \"Jeg skal have indkøbt æg og det skal gå stærkt!\" ud af Anders Madsen til adressen Ryesgade 32, 8000 Aarhus.\n\nDu har betalt 1.234,57 dkr til Anders Madsen som løn for hans udbringning.\n\nTak fordi du har valgt at bruge EpsilonApi!\nVi ser frem til at hjælpe dig fremover med udbringning.\n\nMed venlig hilsen\nEpsilonApi"
			};
			mail.should.deep.equal(expectedMail);
			done();
		});


		it("Should be able to create a receipt mail for the deliverer", (done) => {
			const receiver = { name: "Peter Hansen" };
			const deliverer = { name: "Anders Madsen", email: "deliverer@developer.dk" };
			const order = { description: "Jeg skal have indkøbt æg og det skal gå stærkt!", deliveryAddress: { name: "Ryesgade 32, 8000 Aarhus" }, scheduledDeliveryTime: 700000 };
			const bid = { deliveryPrice: 3100.909 };
			const mail = factory.createReceiptMailForDeliverer(receiver, deliverer, order, bid);

			const expectedMail = {
				from: "EpsilonApi <support@epsilon-api.com>",
				to: "deliverer@developer.dk",
				subject: "EpsilonApi - Fuldendt levering",
				html: "<!DOCTYPE html \"-//w3c//dtd xhtml 1.0 transitional //en\" \"http://www.w3.org/tr/xhtml1/dtd/xhtml1-transitional.dtd\"><html xmlns=\"http://www.w3.org/1999/xhtml\"><head> <!--[if gte mso 9]><xml> <o:OfficeDocumentSettings> <o:AllowPNG/> <o:PixelsPerInch>96</o:PixelsPerInch> </o:OfficeDocumentSettings> </xml><![endif]--> <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"> <meta name=\"viewport\" content=\"width=device-width\"> <meta http-equiv=\"X-UA-Compatible\" content=\"IE=9; IE=8; IE=7; IE=EDGE\"> <title>Template Base</title> </head> <body style=\"width: 100% !important;min-width: 100%;-webkit-text-size-adjust: 100%;-ms-text-size-adjust: 100% !important;margin: 0;padding: 0;background-color: #FFFFFF\"> <style id=\"media-query\"> /* Client-specific Styles & Reset */ #outlook a { padding: 0; } /* .ExternalClass applies to Outlook.com (the artist formerly known as Hotmail) */ .ExternalClass { width: 100%; } .ExternalClass, .ExternalClass p, .ExternalClass span, .ExternalClass font, .ExternalClass td, .ExternalClass div { line-height: 100%; } #backgroundTable { margin: 0; padding: 0; width: 100% !important; line-height: 100% !important; } /* Buttons */ .button a { display: inline-block; text-decoration: none; -webkit-text-size-adjust: none; text-align: center; } .button a div { text-align: center !important; } /* Outlook First */ body.outlook p { display: inline !important; } /* Media Queries */ @media only screen and (max-width: 500px) { table[class=\"body\"] img { height: auto !important; width: 100% !important; } table[class=\"body\"] img.fullwidth { max-width: 100% !important; } table[class=\"body\"] center { min-width: 0 !important; } table[class=\"body\"] .container { width: 95% !important; } table[class=\"body\"] .row { width: 100% !important; display: block !important; } table[class=\"body\"] .wrapper { display: block !important; padding-right: 0 !important; } table[class=\"body\"] .columns, table[class=\"body\"] .column { table-layout: fixed !important; float: none !important; width: 100% !important; padding-right: 0px !important; padding-left: 0px !important; display: block !important; } table[class=\"body\"] .wrapper.first .columns, table[class=\"body\"] .wrapper.first .column { display: table !important; } table[class=\"body\"] table.columns td, table[class=\"body\"] table.column td, .col { width: 100% !important; } table[class=\"body\"] table.columns td.expander { width: 1px !important; } table[class=\"body\"] .right-text-pad, table[class=\"body\"] .text-pad-right { padding-left: 10px !important; } table[class=\"body\"] .left-text-pad, table[class=\"body\"] .text-pad-left { padding-right: 10px !important; } table[class=\"body\"] .hide-for-small, table[class=\"body\"] .show-for-desktop { display: none !important; } table[class=\"body\"] .show-for-small, table[class=\"body\"] .hide-for-desktop { display: inherit !important; } .mixed-two-up .col { width: 100% !important; } } @media screen and (max-width: 500px) { div[class=\"col\"] { width: 100% !important; } } @media screen and (min-width: 501px) { table[class=\"container\"] { width: 500px !important; } } </style> <table class=\"body\" style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;height: 100%;width: 100%;table-layout: fixed\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" border=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td class=\"center\" style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;text-align: center;background-color: #FFFFFF\" align=\"center\" valign=\"top\"> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;background-color: #FFFFFF\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"100%\"> <!--[if gte mso 9]> <table id=\"outlookholder\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\"><tr><td> <![endif]--> <!--[if (IE)]> <table width=\"500\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"> <tr> <td> <![endif]--> <table class=\"container\" style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;max-width: 500px;margin: 0 auto;text-align: inherit\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"100%\"><table class=\"block-grid\" style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;width: 100%;max-width: 500px;color: #333;background-color: transparent\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" bgcolor=\"transparent\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;text-align: center;font-size: 0\"><!--[if (gte mso 9)|(IE)]><table width=\"100%\" align=\"center\" bgcolor=\"transparent\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tr><![endif]--><!--[if (gte mso 9)|(IE)]><td valign=\"top\" width=\"500\"><![endif]--><div class=\"col num12\" style=\"display: inline-block;vertical-align: top;width: 100%\"><table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;background-color: transparent;padding-top: 20px;padding-right: 0px;padding-bottom: 20px;padding-left: 0px;border-top: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-left: 0px solid transparent\"><table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" border=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;width: 100%\" align=\"center\"> <div style=\"font-size:12px\" align=\"center\"> <img class=\"center fullwidth\" style=\"outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: block;border: 0;height: auto;line-height: 100%;margin: 0 auto;float: none;width: 100% !important;max-width: 500px\" align=\"center\" border=\"0\" src=\"https://epsilon-api.com/images/mail-header.png\" alt=\"Image\" title=\"Image\" width=\"500\"> </div> </td> </tr> </tbody></table> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" align=\"center\" width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;padding-top: 10px;padding-right: 10px;padding-bottom: 10px;padding-left: 10px\" align=\"center\"> <div style=\"height: 1px;\"> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;border-top: 1px solid #BBBBBB;width: 100%\" align=\"center\" border=\"0\" cellspacing=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" align=\"center\"></td> </tr> </tbody></table> </div> </td> </tr> </tbody></table><table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;padding-top: 10px;padding-right: 10px;padding-bottom: 0px;padding-left: 10px\"> <div style=\"color:#FFFFFF;line-height:120%;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;\"> <div style=\"font-size:12px;line-height:14px;color:#FFFFFF;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;text-align:left;\"><p style=\"margin: 0;font-size: 12px;line-height: 14px;text-align: left\"><span style=\"font-size: 24px; line-height: 28px;\"><span style=\"line-height: 28px; font-size: 24px;\"><span style=\"color: rgb(0, 0, 0); font-size: 24px; line-height: 28px;\" color=\"#000000\">Kvittering</span>&nbsp;</span><span style=\"line-height: 28px; font-size: 24px;\"><strong>&#65279;</strong></span></span></p></div> </div> </td> </tr> </tbody></table> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;padding-top: 10px;padding-right: 10px;padding-bottom: 10px;padding-left: 10px\"> <div style=\"color:#555555;line-height:120%;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;\"> <div style=\"font-family:inherit;font-size:12px;line-height:14px;color:#555555;text-align:left;\"><p style=\"margin: 0;font-size: 12px;line-height: 14px\"><span style=\"font-size: 18px; line-height: 21px;\"><span style=\"line-height: 21px; font-size: 18px;\">Hej Anders</span><span style=\"font-size: 18px; line-height: 21px;\" id=\"_mce_caret\" data-mce-bogus=\"true\"><span style=\"line-height: 21px; font-size: 18px;\">&#65279;</span></span></span><span style=\"font-size: 18px; line-height: 21px;\"><span style=\"line-height: 21px; font-size: 18px;\">&#65279;</span></span></p></div> </div> </td> </tr> </tbody></table> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;padding-top: 15px;padding-right: 10px;padding-bottom: 10px;padding-left: 10px\"> <div style=\"color:#010000;line-height:120%;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;\"> <div style=\"font-size:12px;line-height:14px;color:#010000;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;text-align:left;\"><p style=\"margin: 0;font-size: 12px;line-height: 14px\"><span style=\"font-size: 16px; line-height: 19px;\">&nbsp;</span><br></p><p style=\"margin: 0;font-size: 12px;line-height: 14px\"><span style=\"font-size: 16px; line-height: 19px;\">Du har d. 1/1-1970 kl. 01:11 leveret \"Jeg skal have indkøbt æg og det skal gå stærkt!\" til Peter Hansen til adressen Ryesgade 32, 8000 Aarhus.</span></p><p style=\"margin: 0;font-size: 12px;line-height: 14px\"><span style=\"font-size: 16px; line-height: 19px;\">&nbsp;</span></p><p style=\"margin: 0;font-size: 12px;line-height: 14px\"><br><span style=\"font-size: 16px; line-height: 19px;\">Din l&#248;n som du har tjent udg&#248;r 3.100,91 dkr.</span></p><p style=\"margin: 0;font-size: 12px;line-height: 14px\"><span style=\"font-size: 16px; line-height: 19px;\">&nbsp;</span></p><p style=\"margin: 0;font-size: 12px;line-height: 14px\"><br><span style=\"font-size: 16px; line-height: 19px;\">Vi har h&#230;vet 10% af dette bel&#248;b p&#229; din konto</span></p><p style=\"margin: 0;font-size: 12px;line-height: 14px\"><span style=\"font-size: 16px; line-height: 19px;\">til d&#230;kning af vores administrationsomkostninger.</span></p><p style=\"margin: 0;font-size: 12px;line-height: 14px\"><span style=\"font-size: 16px; line-height: 19px;\">&nbsp;</span></p><p style=\"margin: 0;font-size: 12px;line-height: 14px\"><br><span style=\"font-size: 16px; line-height: 19px;\">Med venlig hilsen</span></p><p style=\"margin: 0;font-size: 12px;line-height: 14px\"><span style=\"font-size: 16px; line-height: 19px;\">EpsilonApi</span></p></div> </div> </td> </tr> </tbody></table> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td class=\"button-container\" style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;padding-top: 10px;padding-right: 10px;padding-bottom: 10px;padding-left: 10px\" align=\"center\"> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\"> <tbody><tr style=\"vertical-align: top\"> <td class=\"button\" style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"100%\" align=\"center\" valign=\"middle\"> <!--[if mso]> <v:roundrect xmlns:v=\"urn:schemas-microsoft-com:vml\" xmlns:w=\"urn:schemas-microsoft-com:office:word\" href=\"mailto:support@epsilon-api.com?subject=Indsigelse vdr administrationsgebyr&body=\" style=\" height:58px; v-text-anchor:middle; width:338px;\" arcsize=\"7%\" strokecolor=\"#E18B52\" fillcolor=\"#E18B52\" > <w:anchorlock/> <center style=\"color:#ffffff; font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif; font-size:14px;\"> <![endif]--> <!--[if !mso]><!- - --><div style=\"display: inline-block; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; max-width: 65%; width: 100%; border-top: 0px solid transparent; border-right: 0px solid transparent; border-bottom: 0px solid transparent; border-left: 0px solid transparent;\" align=\"center\"> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;height: 58\" width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"> <tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; color: #ffffff; background-color: #E18B52; padding-top: 5px; padding-right: 20px; padding-bottom: 5px; padding-left: 20px; font-family: Arial, \"Helvetica Neue\", Helvetica, sans-serif;text-align: center\" valign=\"middle\"><!--<![endif]--> <a style=\"display: inline-block;text-decoration: none;-webkit-text-size-adjust: none;text-align: center;background-color: #E18B52;color: #ffffff\" href=\"mailto:support@epsilon-api.com?subject=Indsigelse vdr administrationsgebyr&body=\" target=\"_blank\"> <span style=\"font-size:12px;line-height:24px;\"><span style=\"font-size: 11px; line-height: 22px;\" data-mce-style=\"font-size: 11px; line-height: 20px;\"><strong><span style=\"line-height: 22px; font-size: 11px;\" data-mce-style=\"line-height: 20px;\">&#65279;Tryk her hvis du ikke er</span></strong></span><span style=\"font-size: 11px; line-height: 22px;\" data-mce-style=\"font-size: 11px; line-height: 20px;\"><strong><span style=\"line-height: 22px; font-size: 11px;\" data-mce-style=\"line-height: 20px;\">&nbsp;enig i indholdet af denne mail og gerne vil kontaktes hurtigst muligt.</span></strong></span></span> </a> <!--[if !mso]><!- - --></td></tr></tbody></table> </div><!--<![endif]--> <!--[if mso]> </center> </v:roundrect> <![endif]--> </td> </tr> </tbody></table> </td> </tr> </tbody></table> </td></tr></tbody></table></div><!--[if (gte mso 9)|(IE)]></td><![endif]--><!--[if (gte mso 9)|(IE)]></td></tr></table><![endif]--></td></tr></tbody></table></td></tr></tbody></table> <!--[if mso]> </td></tr></table> <![endif]--> <!--[if (IE)]> </td></tr></table> <![endif]--> </td> </tr> </tbody></table> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;background-color: #FFFFFF\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"100%\"> <!--[if gte mso 9]> <table id=\"outlookholder\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\"><tr><td> <![endif]--> <!--[if (IE)]> <table width=\"500\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"> <tr> <td> <![endif]--> <table class=\"container\" style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;max-width: 500px;margin: 0 auto;text-align: inherit\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"100%\"><table class=\"block-grid\" style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;width: 100%;max-width: 500px;color: #333;background-color: transparent\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" bgcolor=\"transparent\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;text-align: center;font-size: 0\"><!--[if (gte mso 9)|(IE)]><table width=\"100%\" align=\"center\" bgcolor=\"transparent\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tr><![endif]--><!--[if (gte mso 9)|(IE)]><td valign=\"top\" width=\"500\"><![endif]--><div class=\"col num12\" style=\"display: inline-block;vertical-align: top;width: 100%\"><table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;background-color: transparent;padding-top: 30px;padding-right: 0px;padding-bottom: 30px;padding-left: 0px;border-top: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-left: 0px solid transparent\"><table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" border=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;width: 100%;padding-top: 0px;padding-right: 0px;padding-bottom: 0px;padding-left: 0px\" align=\"center\"> <div style=\"font-size:12px\" align=\"center\"> <img class=\"center fullwidth\" style=\"outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: block;border: 0;height: auto;line-height: 100%;margin: 0 auto;float: none;width: 100% !important;max-width: 500px\" align=\"center\" border=\"0\" src=\"https://epsilon-api.com/images/mail-footer.png\" alt=\"Image\" title=\"Image\" width=\"500\"> </div> </td> </tr> </tbody></table> </td></tr></tbody></table></div><!--[if (gte mso 9)|(IE)]></td><![endif]--><!--[if (gte mso 9)|(IE)]></td></tr></table><![endif]--></td></tr></tbody></table></td></tr></tbody></table> <!--[if mso]> </td></tr></table> <![endif]--> <!--[if (IE)]> </td></tr></table> <![endif]--> </td> </tr> </tbody></table> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;background-color: #010000\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"100%\"> <!--[if gte mso 9]> <table id=\"outlookholder\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\"><tr><td> <![endif]--> <!--[if (IE)]> <table width=\"500\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"> <tr> <td> <![endif]--> <table class=\"container\" style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;max-width: 500px;margin: 0 auto;text-align: inherit\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"100%\"><table class=\"block-grid\" style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;width: 100%;max-width: 500px;color: #333;background-color: transparent\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" bgcolor=\"transparent\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;text-align: center;font-size: 0\"><!--[if (gte mso 9)|(IE)]><table width=\"100%\" align=\"center\" bgcolor=\"transparent\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tr><![endif]--><!--[if (gte mso 9)|(IE)]><td valign=\"top\" width=\"500\"><![endif]--><div class=\"col num12\" style=\"display: inline-block;vertical-align: top;width: 100%\"><table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;background-color: transparent;padding-top: 25px;padding-right: 0px;padding-bottom: 25px;padding-left: 0px;border-top: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-left: 0px solid transparent\"> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" align=\"center\" valign=\"top\"> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;text-align: center;padding-top: 10px;padding-right: 10px;padding-bottom: 10px;padding-left: 10px;max-width: 82px\" align=\"center\" valign=\"top\"> <!--[if (gte mso 9)|(IE)]> <table width=\"92\" align=\"left\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"> <tr> <td align=\"left\"> <![endif]--> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" width=\"100%\" align=\"left\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" align=\"left\" valign=\"middle\"> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;padding: 0 5px 5px 0\" align=\"left\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" height=\"37\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"37\" align=\"left\" valign=\"middle\"> <a href=\"https://www.facebook.com/EpsilonApi\" title=\"Facebook\" target=\"_blank\"> <img style=\"outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: block;border: none;height: auto;line-height: 100%;max-width: 32px !important\" src=\"https://epsilon-api.com/images/facebook.png\" alt=\"Facebook\" title=\"Facebook\" width=\"32\"> </a> </td> </tr> </tbody></table> </td> </tr> </tbody></table> <!--[if (gte mso 9)|(IE)]> </td> </tr> </table> <![endif]--> </td> </tr> </tbody></table> </td> </tr> </tbody></table></td></tr></tbody></table></div><!--[if (gte mso 9)|(IE)]></td><![endif]--><!--[if (gte mso 9)|(IE)]></td></tr></table><![endif]--></td></tr></tbody></table></td></tr></tbody></table> <!--[if mso]> </td></tr></table> <![endif]--> <!--[if (IE)]> </td></tr></table> <![endif]--> </td> </tr> </tbody></table> </td> </tr> </tbody></table> </body></html>",
				text: "Kvittering\n\nHej Anders\n\nDu har d. 1/1-1970 kl. 01:11 leveret \"Jeg skal have indkøbt æg og det skal gå stærkt!\" til Peter Hansen til adressen Ryesgade 32, 8000 Aarhus.\n\n Din løn som du har tjent udgør 3.100,91 dkr.\n\nVi har hævet 10% af dette beløb på din konto til dækning af vores administrationsomkostninger.\n\nMed venlig hilsen\nEpsilonApi\n\nSend os en mail med det samme, hvis du ikke er enig i indholdet af denne mail."
			};
			mail.should.deep.equal(expectedMail);
			done();
		});

		
		it("Should be able to create a receipt mail for EpsilonApi", (done) => {
			const receiver = { name: "Peter Hansen", email: "receiver@developer.dk", mobile: "12345678" };
			const deliverer = { name: "Anders Madsen", email: "deliverer@developer.dk", mobile: "12124444" };
			const order = { description: "Jeg skal have indkøbt æg og det skal gå stærkt!", pickupAddress: { name: "Føtex i Storcenter Nord" }, deliveryAddress: { name: "Ryesgade 32, 8000 Aarhus" }, scheduledDeliveryTime: 7000000 };
			const mail = factory.createReceiptMailForEpsilonApi(receiver, deliverer, order, undefined);

			const expectedMail = {
				from: "EpsilonApi <support@epsilon-api.com>",
				to: Configuration.mail.receiverInTest,
				subject: "EpsilonApi - Fuldendt opgave",
				html: "<!DOCTYPE html \"-//w3c//dtd xhtml 1.0 transitional //en\" \"http://www.w3.org/tr/xhtml1/dtd/xhtml1-transitional.dtd\"><html xmlns=\"http://www.w3.org/1999/xhtml\"><head> <!--[if gte mso 9]><xml> <o:OfficeDocumentSettings> <o:AllowPNG/> <o:PixelsPerInch>96</o:PixelsPerInch> </o:OfficeDocumentSettings> </xml><![endif]--> <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"> <meta name=\"viewport\" content=\"width=device-width\"> <meta http-equiv=\"X-UA-Compatible\" content=\"IE=9; IE=8; IE=7; IE=EDGE\"> <title>Template Base</title> </head> <body style=\"width: 100% !important;min-width: 100%;-webkit-text-size-adjust: 100%;-ms-text-size-adjust: 100% !important;margin: 0;padding: 0;background-color: #FFFFFF\"> <style id=\"media-query\"> /* Client-specific Styles & Reset */ #outlook a { padding: 0; } /* .ExternalClass applies to Outlook.com (the artist formerly known as Hotmail) */ .ExternalClass { width: 100%; } .ExternalClass, .ExternalClass p, .ExternalClass span, .ExternalClass font, .ExternalClass td, .ExternalClass div { line-height: 100%; } #backgroundTable { margin: 0; padding: 0; width: 100% !important; line-height: 100% !important; } /* Buttons */ .button a { display: inline-block; text-decoration: none; -webkit-text-size-adjust: none; text-align: center; } .button a div { text-align: center !important; } /* Outlook First */ body.outlook p { display: inline !important; } /* Media Queries */ @media only screen and (max-width: 500px) { table[class=\"body\"] img { height: auto !important; width: 100% !important; } table[class=\"body\"] img.fullwidth { max-width: 100% !important; } table[class=\"body\"] center { min-width: 0 !important; } table[class=\"body\"] .container { width: 95% !important; } table[class=\"body\"] .row { width: 100% !important; display: block !important; } table[class=\"body\"] .wrapper { display: block !important; padding-right: 0 !important; } table[class=\"body\"] .columns, table[class=\"body\"] .column { table-layout: fixed !important; float: none !important; width: 100% !important; padding-right: 0px !important; padding-left: 0px !important; display: block !important; } table[class=\"body\"] .wrapper.first .columns, table[class=\"body\"] .wrapper.first .column { display: table !important; } table[class=\"body\"] table.columns td, table[class=\"body\"] table.column td, .col { width: 100% !important; } table[class=\"body\"] table.columns td.expander { width: 1px !important; } table[class=\"body\"] .right-text-pad, table[class=\"body\"] .text-pad-right { padding-left: 10px !important; } table[class=\"body\"] .left-text-pad, table[class=\"body\"] .text-pad-left { padding-right: 10px !important; } table[class=\"body\"] .hide-for-small, table[class=\"body\"] .show-for-desktop { display: none !important; } table[class=\"body\"] .show-for-small, table[class=\"body\"] .hide-for-desktop { display: inherit !important; } .mixed-two-up .col { width: 100% !important; } } @media screen and (max-width: 500px) { div[class=\"col\"] { width: 100% !important; } } @media screen and (min-width: 501px) { table[class=\"container\"] { width: 500px !important; } } </style> <table class=\"body\" style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;height: 100%;width: 100%;table-layout: fixed\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" border=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td class=\"center\" style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;text-align: center;background-color: #FFFFFF\" align=\"center\" valign=\"top\"> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;background-color: #FFFFFF\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"100%\"> <!--[if gte mso 9]> <table id=\"outlookholder\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\"><tr><td> <![endif]--> <!--[if (IE)]> <table width=\"500\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"> <tr> <td> <![endif]--> <table class=\"container\" style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;max-width: 500px;margin: 0 auto;text-align: inherit\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"100%\"><table class=\"block-grid\" style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;width: 100%;max-width: 500px;color: #333;background-color: transparent\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" bgcolor=\"transparent\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;text-align: center;font-size: 0\"><!--[if (gte mso 9)|(IE)]><table width=\"100%\" align=\"center\" bgcolor=\"transparent\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tr><![endif]--><!--[if (gte mso 9)|(IE)]><td valign=\"top\" width=\"500\"><![endif]--><div class=\"col num12\" style=\"display: inline-block;vertical-align: top;width: 100%\"><table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;background-color: transparent;padding-top: 20px;padding-right: 0px;padding-bottom: 20px;padding-left: 0px;border-top: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-left: 0px solid transparent\"><table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" border=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;width: 100%\" align=\"center\"> <div style=\"font-size:12px\" align=\"center\"> <img class=\"center fullwidth\" style=\"outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: block;border: 0;height: auto;line-height: 100%;margin: 0 auto;float: none;width: 100% !important;max-width: 500px\" align=\"center\" border=\"0\" src=\"https://epsilon-api.com/images/mail-header.png\" alt=\"Image\" title=\"Image\" width=\"500\"> </div> </td> </tr> </tbody></table> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" align=\"center\" width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;padding-top: 10px;padding-right: 10px;padding-bottom: 10px;padding-left: 10px\" align=\"center\"> <div style=\"height: 1px;\"> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;border-top: 1px solid #BBBBBB;width: 100%\" align=\"center\" border=\"0\" cellspacing=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" align=\"center\"></td> </tr> </tbody></table> </div> </td> </tr> </tbody></table><table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;padding-top: 10px;padding-right: 10px;padding-bottom: 0px;padding-left: 10px\"> <div style=\"color:#FFFFFF;line-height:120%;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;\"> <div style=\"font-size:12px;line-height:14px;color:#FFFFFF;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;text-align:left;\"><p style=\"margin: 0;font-size: 12px;line-height: 14px;text-align: left\"><span style=\"font-size: 24px; line-height: 28px;\"><span style=\"line-height: 28px; font-size: 24px;\"><font color=\"#000000\">Kvittering</font>&nbsp;</span><span style=\"line-height: 28px; font-size: 24px;\"><strong>&#65279;</strong></span></span></p></div> </div> </td> </tr> </tbody></table> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;padding-top: 15px;padding-right: 10px;padding-bottom: 10px;padding-left: 10px\"> <div style=\"color:#010000;line-height:120%;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;\"> <div style=\"font-size:12px;line-height:14px;color:#010000;font-family:Arial, \"Helvetica Neue\", Helvetica, sans-serif;text-align:left;\"><p style=\"margin: 0;font-size: 14px;line-height: 17px;text-align: left\">d. 1/1-1970 kl. 02:56 har følgende to brugere gennemf&#248;rt en aftale om udbringning af \"Jeg skal have indkøbt æg og det skal gå stærkt!\"</p><p style=\"margin: 0;font-size: 14px;line-height: 16px;text-align: left\">fra: Føtex i Storcenter Nord</p><p style=\"margin: 0;font-size: 14px;line-height: 16px;text-align: left\">til: Ryesgade 32, 8000 Aarhus</p><p style=\"margin: 0;font-size: 14px;line-height: 16px;text-align: left\">&nbsp;<br></p><p style=\"margin: 0;font-size: 14px;line-height: 16px;text-align: left\"><span style=\"font-size: 18px; line-height: 21px;\">Bestilleren:</span></p><p style=\"margin: 0;font-size: 14px;line-height: 16px;text-align: left\">Peter Hansen</p><p style=\"margin: 0;font-size: 14px;line-height: 16px;text-align: left\">tel: 12345678</p><p style=\"margin: 0;font-size: 14px;line-height: 16px;text-align: left\">Email: receiver@developer.dk</p><p style=\"margin: 0;font-size: 14px;line-height: 16px;text-align: left\"><p style=\"margin: 0;font-size: 14px;line-height: 16px;text-align: left\">&nbsp;<br></p><p style=\"margin: 0;font-size: 14px;line-height: 16px;text-align: left\">og</p><p style=\"margin: 0;font-size: 14px;line-height: 16px;text-align: left\">&nbsp;</p><p style=\"margin: 0;font-size: 14px;line-height: 16px;text-align: left\"><span style=\"font-size: 16px; line-height: 19px;\">Udbringeren:</span></p><p style=\"margin: 0;font-size: 14px;line-height: 16px;text-align: left\">Anders Madsen</p><p style=\"margin: 0;font-size: 12px;line-height: 14px;text-align: left\"><span style=\"font-size: 14px; line-height: 16px;\">tel: 12124444</span></p><p style=\"margin: 0;font-size: 12px;line-height: 14px;text-align: left\"><span style=\"font-size: 14px; line-height: 16px;\">Email: deliverer@developer.dk</span></p><p style=\"margin: 0;font-size: 12px;line-height: 14px\"><span style=\"font-size: 14px; line-height: 16px;\"></span></p><p style=\"margin: 0;font-size: 14px;line-height: 16px;text-align: left\">&nbsp;&nbsp;<br></p><p style=\"margin: 0;font-size: 12px;line-height: 14px\">&nbsp;&nbsp;</p><p style=\"margin: 0;font-size: 14px;line-height: 16px;text-align: left\"><span style=\"color: rgb(0, 0, 0); font-size: 14px; line-height: 16px;\">Med venlig hilsen</span></p><p style=\"margin: 0;font-size: 14px;line-height: 16px;text-align: left\"><span style=\"color: rgb(0, 0, 0); font-size: 14px; line-height: 16px;\">EpsilonApi</span></p></div> </div> </td> </tr> </tbody></table> </td></tr></tbody></table></div><!--[if (gte mso 9)|(IE)]></td><![endif]--><!--[if (gte mso 9)|(IE)]></td></tr></table><![endif]--></td></tr></tbody></table></td></tr></tbody></table> <!--[if mso]> </td></tr></table> <![endif]--> <!--[if (IE)]> </td></tr></table> <![endif]--> </td> </tr> </tbody></table> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;background-color: #FFFFFF\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"100%\"> <!--[if gte mso 9]> <table id=\"outlookholder\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\"><tr><td> <![endif]--> <!--[if (IE)]> <table width=\"500\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"> <tr> <td> <![endif]--> <table class=\"container\" style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;max-width: 500px;margin: 0 auto;text-align: inherit\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"100%\"><table class=\"block-grid\" style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;width: 100%;max-width: 500px;color: #333;background-color: transparent\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" bgcolor=\"transparent\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;text-align: center;font-size: 0\"><!--[if (gte mso 9)|(IE)]><table width=\"100%\" align=\"center\" bgcolor=\"transparent\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tr><![endif]--><!--[if (gte mso 9)|(IE)]><td valign=\"top\" width=\"500\"><![endif]--><div class=\"col num12\" style=\"display: inline-block;vertical-align: top;width: 100%\"><table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;background-color: transparent;padding-top: 30px;padding-right: 0px;padding-bottom: 30px;padding-left: 0px;border-top: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-left: 0px solid transparent\"><table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" border=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;width: 100%\" align=\"center\"> <div style=\"font-size:12px\" align=\"center\"> <img class=\"center fullwidth\" style=\"outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: block;border: 0;height: auto;line-height: 100%;margin: 0 auto;float: none;width: 100% !important;max-width: 500px\" align=\"center\" border=\"0\" src=\"https://epsilon-api.com/images/mail-footer.png\" alt=\"Image\" title=\"Image\" width=\"500\"> </div> </td> </tr> </tbody></table> </td></tr></tbody></table></div><!--[if (gte mso 9)|(IE)]></td><![endif]--><!--[if (gte mso 9)|(IE)]></td></tr></table><![endif]--></td></tr></tbody></table></td></tr></tbody></table> <!--[if mso]> </td></tr></table> <![endif]--> <!--[if (IE)]> </td></tr></table> <![endif]--> </td> </tr> </tbody></table> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;background-color: #010000\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"100%\"> <!--[if gte mso 9]> <table id=\"outlookholder\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\"><tr><td> <![endif]--> <!--[if (IE)]> <table width=\"500\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"> <tr> <td> <![endif]--> <table class=\"container\" style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;max-width: 500px;margin: 0 auto;text-align: inherit\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"100%\"><table class=\"block-grid\" style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;width: 100%;max-width: 500px;color: #333;background-color: transparent\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" bgcolor=\"transparent\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;text-align: center;font-size: 0\"><!--[if (gte mso 9)|(IE)]><table width=\"100%\" align=\"center\" bgcolor=\"transparent\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tr><![endif]--><!--[if (gte mso 9)|(IE)]><td valign=\"top\" width=\"500\"><![endif]--><div class=\"col num12\" style=\"display: inline-block;vertical-align: top;width: 100%\"><table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" width=\"100%\" border=\"0\"><tbody><tr style=\"vertical-align: top\"><td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;background-color: transparent;padding-top: 25px;padding-right: 0px;padding-bottom: 25px;padding-left: 0px;border-top: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-left: 0px solid transparent\"> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" align=\"center\" valign=\"top\"> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top;text-align: center;padding-top: 10px;padding-right: 10px;padding-bottom: 10px;padding-left: 10px;max-width: 82px\" align=\"center\" valign=\"top\"> <!--[if (gte mso 9)|(IE)]> <table width=\"92\" align=\"left\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"> <tr> <td align=\"left\"> <![endif]--> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top\" width=\"100%\" align=\"left\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" align=\"left\" valign=\"middle\"> <table style=\"border-spacing: 0;border-collapse: collapse;vertical-align: top;padding: 0 5px 5px 0\" align=\"left\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" height=\"37\"> <tbody><tr style=\"vertical-align: top\"> <td style=\"word-break: break-word;border-collapse: collapse !important;vertical-align: top\" width=\"37\" align=\"left\" valign=\"middle\"> <a href=\"https://www.facebook.com/EpsilonApi\" title=\"Facebook\" target=\"_blank\"> <img style=\"outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;clear: both;display: block;border: none;height: auto;line-height: 100%;max-width: 32px !important\" src=\"https://epsilon-api.com/images/facebook.png\" alt=\"Facebook\" title=\"Facebook\" width=\"32\"> </a> </td> </tr> </tbody></table> </td> </tr> </tbody></table> <!--[if (gte mso 9)|(IE)]> </td> </tr> </table> <![endif]--> </td> </tr> </tbody></table> </td> </tr> </tbody></table></td></tr></tbody></table></div><!--[if (gte mso 9)|(IE)]></td><![endif]--><!--[if (gte mso 9)|(IE)]></td></tr></table><![endif]--></td></tr></tbody></table></td></tr></tbody></table> <!--[if mso]> </td></tr></table> <![endif]--> <!--[if (IE)]> </td></tr></table> <![endif]--> </td> </tr> </tbody></table> </td> </tr> </tbody></table> </body></html>",
				text: "Kvittering\n\nd. 1/1-1970 kl. 02:56 har følgende to brugere gennemført en aftale om udbringning af \"Jeg skal have indkøbt æg og det skal gå stærkt!\"\nfra: Føtex i Storcenter Nord\ntil: Ryesgade 32, 8000 Aarhus\n\nBestilleren:\nPeter Hansen\ntel: 12345678\nEmail: receiver@developer.dk\n\nog\n\nUdbringeren:\nAnders Madsen\ntel: 12124444\nEmail: deliverer@developer.dk\n\nMed venlig hilsen\nEpsilonApi"
			};
			mail.should.deep.equal(expectedMail);
			done();
		});
	

	});



	describe("createCreditCard", () => {


		it("Should be able to create a credit card", (done) => {
			state.factory.createId = () => { return "credit-card-id" };
			const creditCard = factory.createCreditCard("credit-card-link");

			const expectedCreditCard = { _id: "credit-card-id", link: "credit-card-link" };
			creditCard.should.deep.equal(expectedCreditCard);
			done();
		});


	});



});